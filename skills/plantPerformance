var request = require('request');
 
module.exports = function (controller) {
	 
	        controller.hears( [/plant performance\b/], 'direct_message,direct_mention', function(bot, message){
		         
	            request('http://194.79.57.109:8080/SFapi/machines', function(error, response, body) {
	                console.log('error:', error); // Print the error if one occurred
	                console.log('statusCode:', response && response.statusCode); // Print the response status code if a response was received
	                console.log('body:', body); // Print the HTML for the Google homepage.
			var mpattern;
			var machs=[];
	                var jsonData = JSON.parse(body);
			for (var i = 0; i <jsonData.machines.lenght ; i++) {
			  	  
				 //machs.push(jsonData.machines[i].machine);
				 //console.log('machine: ',machine);
				
				 //var oee = jsonData.machines[i].alias;
				 //var alias = jsonData.machines[i].alias;
		
				 //console.log(alias);
				 //console.log(oee);
				 //machs.push(machine);
				 console.log('macs: ',macs);
				//mpattern=machs.join("|");
				//console.log('mpattern: ',mpattern);
			}

	            });
	
	             		     //console.log('mpattern:',mpattern);
		     bot.startConversation(message, function (err, convo) {

		     convo.ask("Do you want more details?", 
		     		[
				{ pattern: "^yes|yep|y|Yes$",
				    callback: function (response, convo) {
					convo.gotoThread("yes");
				    },
				},
				{ pattern: "^no|No|n$",
				    callback: function (response, convo) {
					convo.gotoThread("no");
				    },
				},
				[
				{ pattern: "^line1|line2|line3|line4,line5, line7$",
				    callback: function (response, convo) {
					convo.gotoThread("line");
				    },
				},
				{
				    default: true,
				    callback: function (response, convo) {
					convo.say("Sorry, I don't know this color. Try another one...");
					convo.repeat();
					convo.next();
				    }
				}], { key: "answer" });

			    // yes thread
			    convo.addMessage(
				//"Cool, I love '{{responses.answer}}' too",
				"Which line do you want to whatc over?",
				"yes");
				
			    convo.addMessage(
				"Glad having being helped you",
				"no");
			   convo.addMessage(
				//"The '{{responses.answer}}' ha the following performance values:\nAvailability:77.49%\nQuality:97.29\nPerformance:67.76",
            			"line");
			})  
	        } );
	   }
	    
 
